<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分类标签配置管理器 - Rule34-lite</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #111;
            color: #fafafa;
            padding: 2rem;
        }
        
        .config-section {
            background-color: #1a1a1a;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .category-item {
            background-color: #2a2a2a;
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid #0d6efd;
        }
        
        .tag-chip {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            margin: 0.25rem;
            background-color: rgba(13, 110, 253, 0.2);
            border: 1px solid #0d6efd;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .tag-chip:hover {
            background-color: #0d6efd;
        }
        
        .form-control, .form-select {
            background-color: #2a2a2a;
            border: 1px solid #495057;
            color: #fff;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: #2a2a2a;
            border-color: #0d6efd;
            color: #fff;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        .code-output {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">
            <i class="bi bi-gear"></i> 分类标签配置管理器
        </h1>
        
        <div class="row">
            <!-- 左侧：配置编辑 -->
            <div class="col-lg-6">
                <!-- 分类管理 -->
                <div class="config-section">
                    <h3><i class="bi bi-folder"></i> 分类管理</h3>
                    
                    <div class="mb-3">
                        <button class="btn btn-primary" onclick="addCategory()">
                            <i class="bi bi-plus"></i> 添加分类
                        </button>
                    </div>
                    
                    <div id="categoriesList"></div>
                    
                    <!-- 添加分类表单 -->
                    <div id="addCategoryForm" style="display: none;" class="mt-3 p-3 border rounded">
                        <h5>添加新分类</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">分类值</label>
                                <input type="text" class="form-control" id="newCategoryValue" placeholder="例如: video">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">显示名称</label>
                                <input type="text" class="form-control" id="newCategoryLabel" placeholder="例如: 视频">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">图标</label>
                                <input type="text" class="form-control" id="newCategoryIcon" placeholder="例如: bi-play-circle">
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-success" onclick="saveNewCategory()">保存</button>
                            <button class="btn btn-secondary ms-2" onclick="cancelAddCategory()">取消</button>
                        </div>
                    </div>
                </div>
                
                <!-- 标签管理 -->
                <div class="config-section">
                    <h3><i class="bi bi-tags"></i> 标签管理</h3>
                    
                    <div class="mb-3">
                        <label class="form-label">选择分类</label>
                        <select class="form-select" id="tagCategorySelect" onchange="loadCategoryTags()">
                            <option value="">选择分类...</option>
                        </select>
                    </div>
                    
                    <div id="tagGroupsContainer"></div>
                    
                    <div class="mt-3">
                        <button class="btn btn-primary" onclick="addTagGroup()" id="addTagGroupBtn" disabled>
                            <i class="bi bi-plus"></i> 添加标签组
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 右侧：预览和导出 -->
            <div class="col-lg-6">
                <!-- 配置预览 -->
                <div class="config-section">
                    <h3><i class="bi bi-eye"></i> 配置预览</h3>
                    <div id="configPreview"></div>
                </div>
                
                <!-- 代码导出 -->
                <div class="config-section">
                    <h3><i class="bi bi-code"></i> 代码导出</h3>
                    <div class="mb-3">
                        <button class="btn btn-success" onclick="generateConfig()">
                            <i class="bi bi-download"></i> 生成配置代码
                        </button>
                        <button class="btn btn-info ms-2" onclick="copyToClipboard()">
                            <i class="bi bi-clipboard"></i> 复制到剪贴板
                        </button>
                    </div>
                    <div class="code-output" id="codeOutput">
                        点击"生成配置代码"来查看配置...
                    </div>
                </div>
                
                <!-- 使用说明 -->
                <div class="config-section">
                    <h3><i class="bi bi-info-circle"></i> 使用说明</h3>
                    <ol>
                        <li><strong>添加分类：</strong>点击"添加分类"按钮，填写分类信息</li>
                        <li><strong>管理标签：</strong>选择分类后，可以添加标签组和标签</li>
                        <li><strong>生成代码：</strong>配置完成后，点击"生成配置代码"</li>
                        <li><strong>应用配置：</strong>将生成的代码复制到相应文件中</li>
                    </ol>
                    
                    <div class="alert alert-info mt-3">
                        <strong>提示：</strong>
                        <ul class="mb-0">
                            <li>分类值建议使用英文小写，如 "anime", "game"</li>
                            <li>图标使用 Bootstrap Icons，如 "bi-stars"</li>
                            <li>标签可以包含中文，但建议使用英文</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="category-config.js"></script>
    
    <script>
        let currentConfig = JSON.parse(JSON.stringify(GALLERY_CONFIG)); // 深拷贝
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
            updateCategorySelect();
            updatePreview();
        });
        
        function loadCategories() {
            const container = document.getElementById('categoriesList');
            container.innerHTML = '';
            
            currentConfig.categories.forEach((category, index) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                categoryDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="${category.icon}"></i>
                            <strong>${category.label}</strong>
                            <span class="text-muted ms-2">(${category.value})</span>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="removeCategory(${index})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(categoryDiv);
            });
        }
        
        function updateCategorySelect() {
            const select = document.getElementById('tagCategorySelect');
            select.innerHTML = '<option value="">选择分类...</option>';
            
            currentConfig.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.value;
                option.textContent = category.label;
                select.appendChild(option);
            });
        }
        
        function addCategory() {
            document.getElementById('addCategoryForm').style.display = 'block';
        }
        
        function cancelAddCategory() {
            document.getElementById('addCategoryForm').style.display = 'none';
            clearCategoryForm();
        }
        
        function saveNewCategory() {
            const value = document.getElementById('newCategoryValue').value.trim();
            const label = document.getElementById('newCategoryLabel').value.trim();
            const icon = document.getElementById('newCategoryIcon').value.trim();
            
            if (!value || !label || !icon) {
                alert('请填写所有字段');
                return;
            }
            
            // 检查是否已存在
            if (currentConfig.categories.some(cat => cat.value === value)) {
                alert('该分类值已存在');
                return;
            }
            
            currentConfig.categories.push({ value, label, icon });
            currentConfig.tagSuggestions[value] = {};
            
            loadCategories();
            updateCategorySelect();
            updatePreview();
            cancelAddCategory();
        }
        
        function clearCategoryForm() {
            document.getElementById('newCategoryValue').value = '';
            document.getElementById('newCategoryLabel').value = '';
            document.getElementById('newCategoryIcon').value = '';
        }
        
        function removeCategory(index) {
            if (confirm('确定要删除这个分类吗？')) {
                const category = currentConfig.categories[index];
                currentConfig.categories.splice(index, 1);
                delete currentConfig.tagSuggestions[category.value];
                
                loadCategories();
                updateCategorySelect();
                updatePreview();
            }
        }
        
        function loadCategoryTags() {
            const categoryValue = document.getElementById('tagCategorySelect').value;
            const container = document.getElementById('tagGroupsContainer');
            const addBtn = document.getElementById('addTagGroupBtn');
            
            if (!categoryValue) {
                container.innerHTML = '';
                addBtn.disabled = true;
                return;
            }
            
            addBtn.disabled = false;
            container.innerHTML = '';
            
            const tagSuggestions = currentConfig.tagSuggestions[categoryValue] || {};
            
            Object.entries(tagSuggestions).forEach(([groupName, tags]) => {
                addTagGroupToDOM(groupName, tags, categoryValue);
            });
        }
        
        function addTagGroup() {
            const categoryValue = document.getElementById('tagCategorySelect').value;
            if (!categoryValue) return;
            
            const groupName = prompt('请输入标签组名称（如：characters, appearance）：');
            if (!groupName) return;
            
            if (!currentConfig.tagSuggestions[categoryValue]) {
                currentConfig.tagSuggestions[categoryValue] = {};
            }
            
            currentConfig.tagSuggestions[categoryValue][groupName] = [];
            addTagGroupToDOM(groupName, [], categoryValue);
            updatePreview();
        }
        
        function addTagGroupToDOM(groupName, tags, categoryValue) {
            const container = document.getElementById('tagGroupsContainer');
            
            const groupDiv = document.createElement('div');
            groupDiv.className = 'mb-3 p-3 border rounded';
            groupDiv.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5>${groupName}</h5>
                    <button class="btn btn-sm btn-danger" onclick="removeTagGroup('${categoryValue}', '${groupName}')">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                <div class="mb-2">
                    ${tags.map(tag => `<span class="tag-chip" onclick="removeTag('${categoryValue}', '${groupName}', '${tag}')">${tag} <i class="bi bi-x"></i></span>`).join('')}
                </div>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="添加标签" 
                           onkeypress="if(event.key==='Enter') addTag('${categoryValue}', '${groupName}', this)">
                    <button class="btn btn-outline-primary" onclick="addTag('${categoryValue}', '${groupName}', this.previousElementSibling)">
                        <i class="bi bi-plus"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(groupDiv);
        }
        
        function addTag(categoryValue, groupName, input) {
            const tag = input.value.trim();
            if (!tag) return;
            
            if (!currentConfig.tagSuggestions[categoryValue][groupName].includes(tag)) {
                currentConfig.tagSuggestions[categoryValue][groupName].push(tag);
                input.value = '';
                loadCategoryTags();
                updatePreview();
            }
        }
        
        function removeTag(categoryValue, groupName, tag) {
            const tags = currentConfig.tagSuggestions[categoryValue][groupName];
            const index = tags.indexOf(tag);
            if (index > -1) {
                tags.splice(index, 1);
                loadCategoryTags();
                updatePreview();
            }
        }
        
        function removeTagGroup(categoryValue, groupName) {
            if (confirm(`确定要删除标签组"${groupName}"吗？`)) {
                delete currentConfig.tagSuggestions[categoryValue][groupName];
                loadCategoryTags();
                updatePreview();
            }
        }
        
        function updatePreview() {
            const preview = document.getElementById('configPreview');
            preview.innerHTML = `
                <h5>分类数量：${currentConfig.categories.length}</h5>
                <div class="mb-3">
                    ${currentConfig.categories.map(cat => 
                        `<span class="badge bg-primary me-2"><i class="${cat.icon}"></i> ${cat.label}</span>`
                    ).join('')}
                </div>
                <h6>标签统计：</h6>
                <ul>
                    ${Object.entries(currentConfig.tagSuggestions).map(([cat, groups]) => {
                        const totalTags = Object.values(groups).reduce((sum, tags) => sum + tags.length, 0);
                        return `<li>${cat}: ${totalTags} 个标签</li>`;
                    }).join('')}
                </ul>
            `;
        }
        
        function generateConfig() {
            const configCode = `// 自动生成的配置文件
const GALLERY_CONFIG = ${JSON.stringify(currentConfig, null, 4)};

// 导出配置
if (typeof module !== 'undefined' && module.exports) {
    module.exports = GALLERY_CONFIG;
}`;
            
            document.getElementById('codeOutput').textContent = configCode;
        }
        
        function copyToClipboard() {
            const codeOutput = document.getElementById('codeOutput');
            navigator.clipboard.writeText(codeOutput.textContent).then(() => {
                alert('配置代码已复制到剪贴板！');
            }).catch(err => {
                console.error('复制失败:', err);
                alert('复制失败，请手动复制');
            });
        }
    </script>
</body>
</html> 