# Rule34 中文站 - 集成爬取上传系统

一个现代化的Rule34图片画廊网站，支持自动爬取、标签分类和在线浏览。

## 🚀 功能特色

- **🎯 集成中转站**: 一键爬取Rule34图片并自动上传到画廊
- **🏷️ 智能标签系统**: 自动分类艺术家、角色、版权和一般标签
- **📱 响应式设计**: 完美适配桌面和移动设备
- **🔍 强大搜索**: 支持标签、艺术家、角色等多维度搜索
- **⚡ 实时处理**: 爬取一张上传一张，实时进度显示
- **🛡️ 内容过滤**: 支持按评级、评分等条件过滤

## 📁 项目结构

```
rule34-web/
├── html/
│   └── index.html          # 主画廊页面
├── rule34-station.html     # 集成爬取上传中转站
├── tag-manager.html        # 标签管理工具
└── README.md              # 项目说明
```

## 🎮 使用指南

### 1. 画廊浏览 (`html/index.html`)

主页面功能：
- 浏览所有上传的图片
- 按标签搜索和过滤
- 查看图片详情和标签
- 按评级、评分排序

**特色功能：**
- 热门标签展示
- 实时搜索
- 无限滚动加载
- 图片详情模态框

### 2. 中转站 (`rule34-station.html`)

**核心功能：爬取一张上传一张**

#### 配置步骤：
1. **Supabase配置** - 填入项目URL和密钥
2. **爬取配置** - 设置搜索标签、数量、起始页
3. **过滤设置** - 设置最低评分、内容评级等

#### 爬取流程：
1. 点击"测试连接"确保Supabase连接正常
2. 配置爬取参数
3. 点击"开始爬取上传"
4. 系统将自动：
   - 从Rule34 API获取图片信息
   - 下载图片文件
   - 分析并分类标签
   - 上传到Supabase存储
   - 保存元数据到数据库

#### 实时监控：
- 处理统计：已处理/成功/跳过/错误数量
- 进度条：当前批次处理进度
- 处理速度：每分钟处理张数
- 详细日志：每张图片的处理状态

### 3. 标签管理 (`tag-manager.html`)

- 批量编辑已上传图片的标签
- 可视化标签分类（艺术家/角色/版权/一般）
- 快捷标签按钮
- 标签搜索和过滤

## 🏷️ 标签分类系统

系统自动将Rule34标签分类为：

- **🎨 艺术家标签** (`artist:`) - 紫色显示
- **👤 角色标签** (`character:`) - 蓝色显示  
- **📚 版权标签** (`copyright:`) - 橙色显示
- **🏷️ 一般标签** - 灰色显示

## 📊 数据库结构

```sql
-- images表结构
{
  id: 'uuid',
  file_path: 'text',           -- 存储路径
  original_filename: 'text',   -- 原文件名
  tags: 'text[]',              -- 标签数组
  md5: 'text',                 -- MD5哈希（去重）
  rule34_id: 'text',           -- Rule34原始ID
  score: 'integer',            -- 评分
  rating: 'text',              -- 评级 (s/q/e)
  width: 'integer',            -- 宽度
  height: 'integer',           -- 高度
  uploaded_at: 'timestamp',    -- 上传时间
  metadata: 'jsonb'            -- 其他元数据
}
```

## ⚙️ 配置说明

### Supabase配置
- **项目URL**: `https://ibehtwiqwopghgeblflg.supabase.co`
- **存储桶**: `rule`
- **表名**: `images`

### 爬取配置
- **数据源**: Rule34 API (`https://api.rule34.xxx/`)
- **批次大小**: 10-100张（推荐20张）
- **去重机制**: 基于MD5哈希自动跳过已存在图片
- **标签分析**: 通过Rule34标签API自动分类

## 🔧 技术栈

- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **框架**: Bootstrap 5 + Bootstrap Icons
- **后端**: Supabase (数据库 + 存储)
- **API**: Rule34 API
- **部署**: Netlify (自动部署)

## 🚀 部署说明

### 自动部署
项目已配置GitHub + Netlify自动部署：
1. 推送代码到GitHub仓库
2. Netlify自动触发构建
3. 自动部署到生产环境

### 本地运行
```bash
# 启动本地服务器
python -m http.server 8000
# 或
npx serve .
```

## 📝 使用流程

### 首次使用
1. 打开 `rule34-station.html`
2. 测试Supabase连接
3. 配置爬取参数
4. 开始爬取上传

### 日常使用
1. 打开 `html/index.html` 浏览画廊
2. 使用搜索和过滤功能
3. 需要时使用标签管理工具编辑标签

## 🛡️ 特色功能

### 智能去重
- 基于MD5哈希自动检测重复图片
- 启动时加载已存在图片列表
- 自动跳过重复内容

### 断点续传
- 支持暂停/继续爬取
- 自动从指定页码开始
- 处理失败自动重试

### 实时监控
- 详细的处理日志
- 实时统计信息
- 处理速度监控

### 标签智能分类
- 自动识别艺术家、角色、版权标签
- 彩色标签分类显示
- 支持自定义标签

## 🎯 最佳实践

1. **批次大小**: 建议20张，平衡速度和稳定性
2. **过滤设置**: 设置最低评分避免低质量图片
3. **搜索标签**: 使用具体标签提高爬取质量
4. **监控日志**: 及时查看错误信息并调整配置

## 🔧 故障排除

### 连接失败
- 检查Supabase URL和密钥
- 确认网络连接正常

### 上传失败
- 检查存储桶权限
- 确认文件大小限制

### 爬取失败
- 检查Rule34 API可用性
- 调整请求频率避免限制

## 📞 联系方式

如有问题或建议，请提交Issue或联系开发者。

---

## 🎉 更新日志

### v2.0.0 (最新)
- ✨ 全新集成中转站
- 🗑️ 删除分类概念，改用标签系统
- ⚡ 爬取一张上传一张
- 🎨 全新UI设计
- 📊 实时统计监控

### v1.0.0
- 🎉 项目初始版本
- 📱 响应式画廊页面
- 🏷️ 基础标签系统 